<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>News Article | Metro Vigan Hospital</title>
    <meta name="author" content="Metro Vigan Hospital">
    <meta name="description" content="Stay updated with the latest news, events, and health advisories from Metro Vigan Hospital.">
    <meta name="keywords" content="Metro Vigan Hospital news, hospital updates, health news Philippines, Vigan hospital events">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css">
    <!-- Custom CSS (if any) -->
    <link rel="stylesheet" href="../css/style.css">
    <link rel="icon" href="../img/logo/favicon.ico" type="image/x-icon">

</head>
<body class="bg-gray-100 font-roboto">

    <!-- NAVBAR SECTION -->
    <nav id="main-navbar" class="fixed top-0 z-30 w-full bg-white border-b shadow-md sm:px-4 md:px-6 px-10 py-2" aria-label="Main navigation">
    <div class="max-w-screen-xl flex flex-wrap items-center justify-between mx-auto p-4">
      
      <!-- Logo -->
      <a href="../" class="flex items-center justify-center">
        <img src="../img/logo/mvh_logo_optimized.avif" class="h-16 mr-3" alt="MVH Logo" fetchpriority="high" loading="eager"/>
        <div class="flex flex-col align-items-start justify-start">
          <span class="text-2xl font-semibold uppercase whitespace-nowrap hidden xl:inline">Metro Vigan Hospital</span>
          <span class="text-2xl font-semibold whitespace-nowrap inline xl:hidden">MVH</span>
          <span class="md:text-md lg:text-lg text-sm font-semibold whitespace-nowrap inline">ISO 9001:2015 CERTIFIED</span>
        </div>
      </a>
  
      <!-- Toggle Button (Mobile) -->
      <button id="mobile-toggle" type="button" 
              class="inline-flex items-center p-2 text-xl text-green-700 hover:text-black transition justify-center rounded-lg lg:hidden">
        <span class="sr-only">Open main menu</span>
        <i class="fa-solid fa-bars"></i>
      </button>
  
      <!-- Navbar Menu -->
      <div id="navbar-mobile" class="hidden w-full lg:flex lg:w-auto">
        <ul class="font-medium flex flex-col p-4 text-lg lg:flex-row lg:space-x-7">
          <li><a href="../" class="block py-2 hover:underline hover:underline-offset-[0.425rem] hover:decoration-[#04813b]">Home</a></li>
          <li><a href="../services" class="block py-2 hover:underline hover:underline-offset-[0.425rem] hover:decoration-[#04813b]">Services</a></li>
          <li><a href="../facilities" class="block py-2 hover:underline hover:underline-offset-[0.425rem] hover:decoration-[#04813b]">Facilities</a></li>
          <li><a href="../doctors" class="block py-2 hover:underline hover:underline-offset-[0.425rem] hover:decoration-[#04813b]">Doctors</a></li>
          <li><a href="../news" class="block py-2 font-bold hover:underline hover:underline-offset-[0.425rem] hover:decoration-[#04813b] decoration-[#04813b] underline underline-offset-[0.425rem]">News</a></li>
          <li><a href="../careers" class="block py-2 hover:underline hover:underline-offset-[0.425rem] hover:decoration-[#04813b]">Careers</a></li>
          <li><a href="../about-us" class="block py-2 hover:underline hover:underline-offset-[0.425rem] hover:decoration-[#04813b]">About Us</a></li>
          <li class="flex flex-col md:flex-row gap-4">
            <a href="https://labresult.metroviganhospital.com/" target="_blank" class="block w-full md:w-1/2 lg:w-full text-center text-white rounded-md bg-[#16a94c] hover:bg-[#04813b] px-6 py-2">
                Lab Results
            </a>
            <a href="../contact-us" class="block w-full md:w-1/2 lg:hidden text-center text-white rounded-md bg-[#16a94c] hover:bg-[#04813b] px-6 py-2">
                Contact Us
            </a>
          </li>
        </ul>
      </div>

    </div>
    </nav>

    <main class="pt-32">
      <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-12 md:py-16">
          <div id="article-container" class="max-w-4xl mx-auto bg-white rounded-lg shadow-lg p-8 md:p-12">
              <!-- Loading Spinner -->
              <div id="loading" class="text-center py-12">
                  <i class="fas fa-spinner fa-spin text-4xl text-green-600"></i>
                  <p class="mt-2 text-gray-600">Loading Article...</p>
              </div>
              <!-- Article content will be injected here -->
          </div>

          <!-- Related News Section -->
          <div class="max-w-4xl mx-auto mt-16">
              <h2 class="text-3xl font-bold text-gray-900 mb-8">Related News</h2>
              <div id="related-news-grid" class="grid sm:grid-cols-2 md:grid-cols-3 gap-8">
                  <!-- Related articles will be injected here -->
              </div>
          </div>
      </div>
    </main>

    <!-- FOOTER -->
    <footer class="bg-gray-50 text-gray-800">
    <div class="max-w-7xl mx-auto px-6 md:px-12 py-12 grid grid-cols-1 md:grid-cols-4 gap-10">
      
      <!-- Logo & About -->
      <div>
        <div class="flex items-center space-x-3">
          <img src="../img/logo/mvh_logo_optimized.avif" loading="lazy" fetchpriority="low" alt="Metro Vigan Hospital Logo" class="h-12 w-auto">
          <span class="text-lg font-semibold">Metro Vigan Hospital</span>
        </div>
        <p class="mt-4 text-gray-600 text-sm leading-relaxed">
          Entrust your health to us!
        </p>
        <p class="text-gray-600 text-sm leading-relaxed">
          We Care, We Cure, We Can.
        </p>
      </div>

      <!-- Quick Links -->
      <div>
        <h3 class="text-lg font-semibold mb-4">Quick Links</h3>
        <ul class="space-y-2 text-gray-600 text-sm">
          <li><a href="../services" class="hover:text-[#04813b] transition">Our Services</a></li>
          <li><a href="../facilities" class="hover:text-[#04813b] transition">Our Facilities</a></li>
          <li><a href="../doctors" class="hover:text-[#04813b] transition">Our Doctors</a></li>
          <li><a href="../about-us" class="hover:text-[#04813b] transition">About Us</a></li>
          <li><a href="../news" class="hover:text-[#04813b] transition">News</a></li>
          <li><a href="../careers" class="hover:text-[#04813b] transition">Careers</a></li>
          <li><a href="https://labresult.metroviganhospital.com/" target="_blank" class="hover:text-[#04813b] transition">Lab Results</a></li>
          <li><a href="../contact-us" class="hover:text-[#04813b] transition">Contact Us</a></li>
        </ul>
      </div>

      <!-- Contact Info -->
      <div>
        <h3 class="text-lg font-semibold mb-4">Contact Us</h3>
        <ul class="space-y-3 text-gray-600 text-sm">
          <li class="flex items-center space-x-2">
            <i class="fa-solid fa-envelope text-green-700"></i>
            <span>
              <a href="mailto:info@metroviganhospital.com?cc=marketing@metroviganhospital.com" target="_blank" class="hover:underline hover:underline-offset-2">
                info@metroviganhospital.com
              </a>
            </span>
          </li>

          <li class="flex items-center space-x-2">
            <i class="fa-solid fa-phone text-green-700"></i>
            <span>
              <a href="tel:(077) 674 0587" class="hover:underline hover:underline-offset-2">
                (077) 674 0587
              </a>
            </span>
          </li>

          <li class="flex items-center space-x-2">
            <i class="fa-solid fa-map-pin text-green-700"></i>
            <span>
              <a href="https://maps.app.goo.gl/acCeWcUGXqfhwvtcA" target="_blank" class="hover:underline hover:underline-offset-2">
                Rizal St., Brgy. IV (Poblacion), Bantay, Philippines
              </a>
            </span>
          </li>

        </ul>
      </div>

      <!-- Social Media -->
      <div>
        <h3 class="text-lg font-semibold mb-4">Follow Us</h3>
        <div class="flex space-x-4">
          <!-- Facebook -->
          <a href="https://www.facebook.com/metroviganhospital" target="_blank" class="hover:text-[#04813b] transition" aria-label="Facebook">
            <i class="fa-brands fa-facebook text-gray-600 hover:text-[#04813b] transition text-2xl"></i>
          </a>
          <!-- Instagram -->
          <a href="https://www.instagram.com/metroviganhospital/" target="_blank" class="hover:text-[#04813b] transition" aria-label="Instagram">
            <i class="fa-brands fa-instagram text-gray-600 hover:text-[#04813b] transition text-2xl"></i>
          </a>
        </div>
      </div>

    </div>

    <!-- Bottom Bar -->
    <div class="border-t border-gray-200 mt-8">
      <div class="max-w-7xl mx-auto px-6 md:px-12 py-4 flex flex-col md:flex-row justify-between items-center text-sm text-gray-500">
        <span class="p-2 text-[0.5rem] opacity-80 flex flex-wrap items-center gap-1 justify-center">website created and maintained by <a href="https://xtianbar.vercel.app/" target="_blank"><img src="../img/logo/xtianbar-logo.avif" fetchpriority="low" loading="lazy" alt="Metro Vigan Hospital Logo" class="h-2 w-auto"></a></span>
        <p>&copy; 2025 Metro Vigan Hospital. All rights reserved.</p>
        <div class="space-x-4 mt-2 md:mt-0">
          <a href="../privacy-policy" class="hover:text-[#04813b] transition">Privacy Policy</a>
          <a href="../terms-of-service" class="hover:text-[#04813b] transition">Terms of Service</a>
        </div>
      </div>
    </div>
    </footer>

        <!-- Firebase -->
        <script type="module">
          import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
          import { getFirestore, doc, getDoc, collection, getDocs, query } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";
          import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-auth.js";
          
          const firebaseConfig = {
              apiKey: "AIzaSyAG_4ZJS6PhL1m95j0KSKNVOH6vM_erxg8",
              authDomain: "metroviganhospit-1754712078671.firebaseapp.com",
              projectId: "metroviganhospit-1754712078671",
              storageBucket: "metroviganhospit-1754712078671.firebasestorage.app",
              messagingSenderId: "751450211377",
              appId: "1:751450211377:web:b0765182c55f0ead268110",
              measurementId: "G-SKFD2L78KJ"
          };
          const appId = firebaseConfig.appId;
  
          const app = initializeApp(firebaseConfig);
          const db = getFirestore(app);
          const auth = getAuth(app);
  
          const articleContainer = document.getElementById('article-container');
          const loadingEl = document.getElementById('loading');
          const relatedNewsGrid = document.getElementById('related-news-grid');
  
          async function fetchAndDisplayArticle() {
              const params = new URLSearchParams(window.location.search);
              const articleId = params.get('id');
  
              if (!articleId) {
                  articleContainer.innerHTML = `<p class="text-red-500 text-center">Error: No article ID provided.</p>`;
                  return;
              }
  
              try {
                  await signInAnonymously(auth);
                  const articleRef = doc(db, `/artifacts/${appId}/public/data/articles`, articleId);
                  const docSnap = await getDoc(articleRef);
  
                  loadingEl.classList.add('hidden');
  
                  if (docSnap.exists()) {
                      const article = docSnap.data();
                      renderArticle(article);
                      fetchAndDisplayRelatedArticles(articleId); // Fetch related articles
                  } else {
                      articleContainer.innerHTML = `<p class="text-red-500 text-center">Error: Article not found.</p>`;
                  }
              } catch (error) {
                  console.error("Error fetching article:", error);
                  loadingEl.classList.add('hidden');
                  articleContainer.innerHTML = `<p class="text-red-500 text-center">Could not load the article. Please try again later.</p>`;
              }
          }
  
          function renderArticle(article) {
              document.title = `${article.title} - Metro Vigan Hospital`;
  
              const articleDate = article.date.toDate().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
              
              let mainImage = 'https://placehold.co/1200x600/cccccc/ffffff?text=Image+Not+Available';
              let otherImagesHTML = '';
  
              if (article.imageUrls && Array.isArray(article.imageUrls) && article.imageUrls.length > 0) {
                  mainImage = article.imageUrls[0];
                  if (article.imageUrls.length > 1) {
                      // Create a grid for additional images
                      otherImagesHTML = `
                          <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4 my-8">
                              ${article.imageUrls.slice(1).map(url => `
                                  <div>
                                      <img src="${url}" alt="Article image" class="w-full h-48 object-cover rounded-lg shadow-md" onerror="this.style.display='none'">
                                  </div>
                              `).join('')}
                          </div>
                      `;
                  }
              } else if (article.imageUrl && typeof article.imageUrl === 'string') {
                  mainImage = article.imageUrl;
              }
  
              articleContainer.innerHTML = `
                  <a href="../news" class="text-green-600 font-medium hover:underline mb-8 inline-block">&larr; Back to News</a>
                  <h1 class="text-4xl md:text-5xl font-bold text-gray-900 mb-4">${article.title}</h1>
                  <p class="text-gray-500 mb-6">${article.author} &bull; ${articleDate}</p>
                  <img src="${mainImage}" alt="${article.title}" class="w-full h-auto rounded-lg shadow-lg mb-8" onerror="this.onerror=null;this.src='https://placehold.co/1200x600/cccccc/ffffff?text=Image+Not+Found';">
                  <div class="article-content text-gray-700">
                      ${article.content}
                      ${otherImagesHTML}
                  </div>
              `;
          }
  
          async function fetchAndDisplayRelatedArticles(currentArticleId) {
              try {
                  const articlesRef = collection(db, `/artifacts/${appId}/public/data/articles`);
                  const querySnapshot = await getDocs(query(articlesRef));
  
                  let allArticles = [];
                  querySnapshot.forEach(doc => {
                      allArticles.push({ id: doc.id, ...doc.data() });
                  });
  
                  // Filter out the current article and shuffle the rest
                  let relatedArticles = allArticles.filter(article => article.id !== currentArticleId);
                  shuffleArray(relatedArticles);
  
                  // Take the first 3
                  const articlesToDisplay = relatedArticles.slice(0, 3);
  
                  if (articlesToDisplay.length > 0) {
                      relatedNewsGrid.innerHTML = articlesToDisplay.map(createRelatedArticleCardHTML).join('');
                  } else {
                      relatedNewsGrid.innerHTML = '<p class="col-span-3 text-center text-gray-500">No other news available.</p>';
                  }
  
              } catch (error) {
                  console.error("Error fetching related articles:", error);
                  relatedNewsGrid.innerHTML = '<p class="col-span-3 text-center text-red-500">Could not load related news.</p>';
              }
          }
  
          function createRelatedArticleCardHTML(article) {
              const thumbnailUrl = (article.imageUrls && article.imageUrls.length > 0) ? article.imageUrls[0] : article.imageUrl || 'https://placehold.co/600x400/cccccc/ffffff?text=Image+Not+Found';
              
              return `
                  <div class="bg-white rounded-xl shadow-lg overflow-hidden hover:shadow-2xl transition">
                      <img src="${thumbnailUrl}" alt="${article.title}" class="w-full h-48 object-cover" onerror="this.onerror=null;this.src='https://placehold.co/600x400/cccccc/ffffff?text=Image+Not+Found';">
                      <div class="p-6">
                          <h3 class="text-lg font-semibold mb-2 h-14 overflow-hidden">${article.title}</h3>
                          <a href="article.html?id=${article.id}" class="text-green-600 font-medium hover:underline">Read more <i class="fa-solid fa-arrow-right"></i></a>
                      </div>
                  </div>
              `;
          }
          
          // Fisher-Yates shuffle algorithm
          function shuffleArray(array) {
              for (let i = array.length - 1; i > 0; i--) {
                  const j = Math.floor(Math.random() * (i + 1));
                  [array[i], array[j]] = [array[j], array[i]];
              }
          }
  
          document.addEventListener('DOMContentLoaded', () => {
              fetchAndDisplayArticle();
          });
      </script>

    <!-- Mobile Menu Toggle Script -->
    <script>
        // --- Select Elements ---
  const toggleBtn = document.getElementById('mobile-toggle');
  const menu = document.getElementById('navbar-mobile');
  const icon = toggleBtn.querySelector('i');

  // --- Click Event to Toggle Menu ---
  toggleBtn.addEventListener('click', () => {
    menu.classList.toggle('hidden');
    icon.classList.toggle('fa-bars');
    icon.classList.toggle('fa-xmark');
  });

  // --- NEW: Scroll Event to Close Menu ---
  window.addEventListener('scroll', () => {
    // Check if the menu is currently open (!hidden)
    const isMenuOpen = !menu.classList.contains('hidden');

    if (isMenuOpen) {
      // Close the menu
      menu.classList.add('hidden');
      // Reset the icon back to the hamburger
      icon.classList.remove('fa-xmark');
      icon.classList.add('fa-bars');
    }
  });
    </script>
    <script src="../js/go-top-button.js"></script>
</body>
</html>
