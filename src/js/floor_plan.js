    const floors = {
      1: { image: "src/img/floor_plan/1.avif", hotspots: [
          { top: "40%", left: "53%", name: "PHARMACY", images: [
            "src/img/facility/pharmacy.avif", 
            "src/img/facility/pharmacy-2.avif"
          ], descriptions: [
            "Pharmacy: Dispensing medications and health products."
            ] },
            { top: "77%", left: "23%", name: "CT-Scan", images: [
            "src/img/facility/ct-scan.avif"
          ], descriptions: [
            "CT-Scan Department: Advanced imaging services for detailed internal views."
            ] },
          { top: "64%", left: "65.5%", name: "Ultrasound", images: [
            "src/img/facility/ultrasound_2.avif",
            "src/img/facility/ultrasound_1.avif"
          ], descriptions: "Ultrasound Department: Diagnostic imaging services." },
          { top: "47%", left: "78%", name: "X-Ray", images: [
            "src/img/facility/xray_1.avif",
            "src/img/facility/xray_2.avif",
          ], descriptions: "X-Ray Department: Diagnostic imaging services." },
          { top: "80%", left: "75%", name: "Laboratory", images: [
            "src/img/facility/lab_1.avif", 
            "src/img/facility/lab_2.avif"
          ], descriptions: "These laboratories analyze patient samples like blood, urine, and tissue to help doctors diagnose, treat, and monitor diseases. They are equipped with advanced technology and staffed by skilled professionals who perform a wide range of tests." },
          { top: "65%", left: "92%", name: "ER", images: [
            "src/img/facility/er_1.avif",
            "src/img/facility/er_2.avif",
            "src/img/facility/er_3.avif",
          ], descriptions: "The Emergency Room (ER), also known as the Emergency Department (ED) or Accident and Emergency (A&E), is a critical component of a hospital, providing immediate medical care to patients with urgent or life-threatening conditions. It is the first point of contact for individuals experiencing illnesses or injuries requiring prompt attention, often serving as a vital access point for those in crisis. " },
        ] },
      2: { image: "src/img/floor_plan/2.avif", hotspots: [
          { top: "37%", left: "5.2%", name: "Room 224", images: [
            "src/img/facility/or.avif"
          ], descriptions: [
            "Room Details: Regular Private"
            ] },
          { top: "37%", left: "10.2%", name: "Room 222", images: [
            "src/img/facility/or.avif"
          ], descriptions: [
            "Room Details: Regular Private"
            ] },
          { top: "37%", left: "15.2%", name: "Room 220", images: [
            "src/img/facility/or.avif"
          ], descriptions: [
            "Room Details: Regular Private"
            ] },
          { top: "37%", left: "27%", name: "Room 218", images: [
            "src/img/facility/or.avif"
          ], descriptions: [
            "Room Details: Regular Private"
            ] },
          { top: "37%", left: "33.3%", name: "Room 216", images: [
            "src/img/facility/or.avif"
          ], descriptions: [
            "Room Details: Regular Suite"
            ] },
          { top: "37%", left: "38%", name: "Room 214", images: [
            "src/img/facility/or.avif"
          ], descriptions: [
            "Room Details: Regular Suite"
            ] },
          { top: "37%", left: "42.5%", name: "Room 211", images: [
            "src/img/facility/or.avif"
          ], descriptions: [
            "Room Details: Regular Private"
            ] },
          { top: "37%", left: "53.5%", name: "EDP/IT", images: [
            "src/img/facility/it_1.avif",
            "src/img/facility/it_2.avif",
          ], descriptions: "SERVER!!!!!." },

          { top: "44%", left: "62%", name: "Lithotripsy", images: [
            "src/img/facility/lithotripsy.avif"
          ], descriptions: [
            "Ilocos Kidney Stone Center",
            ] },
            { top: "44%", left: "75%", name: "NICU", images: [
            "src/img/facility/nicu.avif"
          ], descriptions: [
            "Newborn Intensive Care Unit (NICU): Specialized care for premature and critically ill newborns.",
            ] },
            { top: "62%", left: "67%", name: "Recovery Room", images: [
            "src/img/facility/or.avif"
          ], descriptions: [
            "Room Details: Regular Private"
            ] },
            { top: "62%", left: "83.5%", name: "Operating Room", images: [
            "src/img/facility/or.avif"
          ], descriptions: [
            "Room Details: Regular Private"
            ] },
            { top: "56%", left: "5.2%", name: "Room 225", images: [
            "src/img/facility/or.avif"
          ], descriptions: [
            "Room Details: Regular Private"
            ] },
          { top: "56%", left: "10.2%", name: "Room 223", images: [
            "src/img/facility/or.avif"
          ], descriptions: [
            "Room Details: Regular Private"
            ] },
          { top: "56%", left: "15.2%", name: "Room 221", images: [
            "src/img/facility/or.avif"
          ], descriptions: [
            "Room Details: Regular Suite"
            ] },
          { top: "56%", left: "24%", name: "Room 219", images: [
            "src/img/facility/or.avif"
          ], descriptions: [
            "Room Details: Regular Private"
            ] },
            { top: "56%", left: "29%", name: "Room 217", images: [
            "src/img/facility/or.avif"
          ], descriptions: [
            "Room Details: Regular Private"
            ] },
          { top: "56%", left: "33.5%", name: "Room 215", images: [
            "src/img/facility/or.avif"
          ], descriptions: [
            "Room Details: Regular Private"
            ] },
          { top: "56%", left: "38%", name: "Room 212", images: [
            "src/img/facility/or.avif"
          ], descriptions: [
            "Room Details: Regular Private"
            ] },
          { top: "56%", left: "42.5%", name: "Room 210", images: [
            "src/img/facility/or.avif"
          ], descriptions: [
            "Room Details: Regular Private"
            ] },
          { top: "56%", left: "47.2%", name: "Room 208", images: [
            "src/img/facility/or.avif"
          ], descriptions: [
            "Room Details: Regular Suite"
            ] },
            { top: "53%", left: "51.5%", name: "Nurse Station 2", images: [
            "src/img/facility/ns2.avif",
            "src/img/facility/ns2_2.avif",
          ], descriptions: [
            "Room Details: Regular Private"
            ] },
            { top: "63%", left: "52%", name: "Nursing Service Office", images: [
            "src/img/facility/or.avif"
          ], descriptions: [
            "Room Details: Regular Private"
            ] },
            { top: "77%", left: "11.5%", name: "Heart Station", images: [
            "src/img/facility/heart_station-1.avif",
            "src/img/facility/heart_station-2.avif",
          ], descriptions: [
            "Room Details: Regular Private"
            ] },
            { top: "77%", left: "24%", name: "Phaeco Room 227", images: [
            "src/img/facility/or.avif"
          ], descriptions: [
            "Room Details: Small Private"
            ] },
            { top: "77%", left: "29%", name: "Phaeco Room 228", images: [
            "src/img/facility/or.avif"
          ], descriptions: [
            "Room Details: Small Private"
            ] },
          { top: "77%", left: "33.5%", name: "Phaeco Room 229", images: [
            "src/img/facility/or.avif"
          ], descriptions: [
            "Room Details: Small Private"
            ] },
          { top: "77%", left: "38%", name: "Phaeco Room 230", images: [
            "src/img/facility/or.avif"
          ], descriptions: [
            "Room Details: Small Private"
            ] },

            { top: "80.5%", left: "69%", name: "Room 205", images: [
            "src/img/facility/or.avif"
          ], descriptions: [
            "Room Details: Small Private"
            ] },
            { top: "80.5%", left: "74%", name: "Room 204", images: [
            "src/img/facility/or.avif"
          ], descriptions: [
            "Room Details: Small Private"
            ] },
            { top: "80.5%", left: "78.5%", name: "Room 203", images: [
            "src/img/facility/or.avif"
          ], descriptions: [
            "Room Details: Small Private"
            ] },
            { top: "80.5%", left: "83.5%", name: "Room 202", images: [
            "src/img/facility/or.avif"
          ], descriptions: [
            "Room Details: Small Private"
            ] },
            { top: "80.5%", left: "88%", name: "Room 201", images: [
            "src/img/facility/or.avif"
          ], descriptions: [
            "Room Details: Small Private"
            ] },

        ] },
      3: { image: "src/img/floor_plan/3.avif", hotspots: [
          { top: "37%", left: "4%", name: "Room 334", images: [
            "src/img/facility/or.avif"
          ], descriptions: [
            "Room Details: Regular Private"
            ] },
          { top: "37%", left: "9.5%", name: "Room 332", images: [
            "src/img/facility/or.avif"
          ], descriptions: [
            "Room Details: Regular Private"
            ] },
          { top: "37%", left: "14.5%", name: "Room 330", images: [
            "src/img/facility/or.avif"
          ], descriptions: [
            "Room Details: Regular Private"
            ] },
          { top: "37%", left: "25%", name: "Ward A", images: [
            "src/img/facility/or.avif"
          ], descriptions: [
            "Room for ICU Relatives"
            ] },
          { top: "37%", left: "32.5%", name: "Room 325", images: [
            "src/img/facility/or.avif"
          ], descriptions: [
            "Room Details: Regular Private"
            ] },
          { top: "37%", left: "37%", name: "Room 323", images: [
            "src/img/facility/or.avif"
          ], descriptions: [
            "Room Details: Regular Private"
            ] },
          { top: "37%", left: "41.5%", name: "Room 321", images: [
            "src/img/facility/or.avif"
          ], descriptions: [
            "Room Details: Regular Private"
            ] },
          { top: "37%", left: "46%", name: "Room 319", images: [
            "src/img/facility/or.avif"
          ], descriptions: [
            "Room Details: Regular Private"
            ] },
          { top: "37%", left: "50.4%", name: "318", images: [
            "src/img/facility/or.avif"
          ], descriptions: "SERVER!!!!!." },
          { top: "37%", left: "54.5%", name: "Room 317", images: [
            "src/img/facility/or.avif"
          ], descriptions: [
            "Room Details: Regular Private"
            ] },
          { top: "44%", left: "60%", name: "Marketing", images: [
            "src/img/facility/or.avif"
          ], descriptions: [
            "Room Details: Regular Private"
            ] },
            { top: "44%", left: "65.3%", name: "TB Dots", images: [
            "src/img/facility/or.avif"
          ], descriptions: [
            "Room Details: Regular Private"
            ] },
            { top: "44%", left: "74%", name: "Room 312", images: [
            "src/img/facility/or.avif"
          ], descriptions: [
            "Room Details: Regular Private"
            ] },
            { top: "44%", left: "80%", name: "Room 310", images: [
            "src/img/facility/or.avif"
          ], descriptions: [
            "Room Details: Regular Private"
            ] },
            { top: "62%", left: "63%", name: "Accounting Office", images: [
            "src/img/facility/or.avif"
          ], descriptions: [
            "Accounting Office: Financial management and billing services.",
            ] },
            { top: "62%", left: "68%", name: "Room 315", images: [
            "src/img/facility/or.avif"
          ], descriptions: [
            "Room Details: Regular Private",
            ] },
            { top: "62%", left: "73.5%", name: "Room 314", images: [
            "src/img/facility/or.avif"
          ], descriptions: [
            "Room Details: Regular Private",
            ] },
            { top: "62%", left: "79%", name: "Room 311", images: [
            "src/img/facility/or.avif"
          ], descriptions: [
            "Room Details: Regular Private",
            ] },
            { top: "62%", left: "84%", name: "ICU 1", images: [
            "src/img/facility/or.avif"
          ], descriptions: [
            "Private ICU"
            ] },
            { top: "62%", left: "88.5%", name: "ICU 2", images: [
            "src/img/facility/or.avif"
          ], descriptions: [
            "Private ICU"
            ] },
            { top: "44%", left: "91%", name: "Main ICU", images: [
            "src/img/facility/or.avif"
          ], descriptions: [
            "Intensive Care Unit (ICU): Critical care for seriously ill patients.",
            ] },
            { top: "56%", left: "4%", name: "Room 333", images: [
            "src/img/facility/or.avif"
          ], descriptions: [
            "Room Details: Regular Private"
            ] },
          { top: "56%", left: "9.5%", name: "Room 331", images: [
            "src/img/facility/or.avif"
          ], descriptions: [
            "Room Details: Regular Private"
            ] },
          { top: "56%", left: "14.5%", name: "Room 329", images: [
            "src/img/facility/or.avif"
          ], descriptions: [
            "Room Details: Regular Private"
            ] },
            { top: "56%", left: "25%", name: "Ward B", images: [
            "src/img/facility/or.avif"
          ], descriptions: [
            "Room for Indigent Patient"
            ] },
          { top: "56%", left: "32.5%", name: "Room 326", images: [
            "src/img/facility/or.avif"
          ], descriptions: [
            "Room Details: Regular Private"
            ] },
          { top: "56%", left: "37%", name: "Room 324", images: [
            "src/img/facility/or.avif"
          ], descriptions: [
            "Room Details: Regular Private"
            ] },
          { top: "56%", left: "41.5%", name: "Room 322", images: [
            "src/img/facility/or.avif"
          ], descriptions: [
            "Room Details: Regular Private"
            ] },
          { top: "56%", left: "46%", name: "Room 320", images: [
            "src/img/facility/or.avif"
          ], descriptions: [
            "Room Details: Regular Private"
            ] },
            { top: "61%", left: "51%", name: "Nurse Station 3", images: [
            "src/img/facility/ns3.avif"
          ], descriptions: [
            "Room Details: Regular Private"
            ] },
            { top: "77%", left: "10%", name: "Room 335", images: [
            "src/img/facility/presidential.avif"
          ], descriptions: [
            "Room Details: Presidential Room"
            ] },
            { top: "77%", left: "17.5%", name: "Nurse Station 3 Annex", images: [
            "src/img/facility/ns3_annex.avif"
          ], descriptions: [
            "Nurse Station 3 Annex: Additional nursing station for patient care.",
            ] },
            { top: "77%", left: "23%", name: "Room 336", images: [
            "src/img/facility/or.avif"
          ], descriptions: [
            "Room Details: Regular Private"
            ] },
            { top: "77%", left: "27.6%", name: "Room 337", images: [
            "src/img/facility/or.avif"
          ], descriptions: [
            "Room Details: Regular Private"
            ] },
          { top: "77%", left: "32.5%", name: "Room 338", images: [
            "src/img/facility/or.avif"
          ], descriptions: [
            "Room Details: Regular Private"
            ] },
          { top: "77%", left: "37%", name: "Room 339", images: [
            "src/img/facility/or.avif"
          ], descriptions: [
            "Room Details: Regular Private"
            ] },

            { top: "80.5%", left: "69%", name: "Room 307", images: [
            "src/img/facility/or.avif"
          ], descriptions: [
            "Room Details: Regular Private"
            ] },
            { top: "80.5%", left: "73.5%", name: "Room 306", images: [
            "src/img/facility/or.avif"
          ], descriptions: [
            "Room Details: Regular Private"
            ] },
            { top: "80.5%", left: "77.8%", name: "Room 305", images: [
            "src/img/facility/or.avif"
          ], descriptions: [
            "Room Details: Regular Private"
            ] },
            { top: "80.5%", left: "82.5%", name: "Room 304", images: [
            "src/img/facility/or.avif"
          ], descriptions: [
            "Room Details: Regular Private"
            ] },
            { top: "80.5%", left: "86.5%", name: "Room 303", images: [
            "src/img/facility/or.avif"
          ], descriptions: [
            "Room Details: Regular Private"
            ] },
            { top: "80.5%", left: "93.7%", name: "Room 302", images: [
            "src/img/facility/or.avif"
          ], descriptions: [
            "Room Details: Regular Private"
            ] },
            { top: "80.5%", left: "96.5%", name: "Room 301", images: [
            "src/img/facility/or.avif"
          ], descriptions: [
            "Room Details: Regular Private"
            ] },

        ] },
      4: { image: "src/img/floor_plan/4.avif", hotspots: [
          { top: "37%", left: "45%", name: "St. Benedict", images: [
            "src/img/facility/or.avif"
          ], descriptions: [
            "Room Details: Regular Private"
            ] },
          { top: "37%", left: "33.5%", name: "San Roque", images: [
            "src/img/facility/or.avif"
          ], descriptions: [
            "Room Details: Regular Private"
            ] },
            { top: "37%", left: "23%", name: "Sto. Niño", images: [
            "src/img/facility/or.avif"
          ], descriptions: [
            "Room Details: Regular Private"
            ] },
            { top: "37%", left: "53.5%", name: "NS4", images: [
            "src/img/facility/or.avif"
          ], descriptions: [
            "Room Details: Regular Private"
            ] },
            { top: "60%", left: "23%", name: "St. Pauline", images: [
            "src/img/facility/or.avif"
          ], descriptions: [
            "Room Details: Regular Private"
            ] },
            { top: "60%", left: "33.5%", name: "St. Catherine", images: [
            "src/img/facility/or.avif"
          ], descriptions: [
            "Room Details: Regular Private"
            ] },
            { top: "60%", left: "45%", name: "St. Therese", images: [
            "src/img/facility/or.avif"
          ], descriptions: [
            "Room Details: Regular Private"
            ] },

            { top: "80.5%", left: "69%", name: "Room 307", images: [
            "src/img/facility/or.avif"
          ], descriptions: [
            "Room Details: Regular Private"
            ] },
            { top: "80.5%", left: "73.5%", name: "Room 306", images: [
            "src/img/facility/or.avif"
          ], descriptions: [
            "Room Details: Regular Private"
            ] },
            { top: "80.5%", left: "77.8%", name: "Room 305", images: [
            "src/img/facility/or.avif"
          ], descriptions: [
            "Room Details: Regular Private"
            ] },
            { top: "80.5%", left: "82.5%", name: "Room 304", images: [
            "src/img/facility/or.avif"
          ], descriptions: [
            "Room Details: Regular Private"
            ] },
            { top: "80.5%", left: "86.5%", name: "Room 303", images: [
            "src/img/facility/or.avif"
          ], descriptions: [
            "Room Details: Regular Private"
            ] },
            { top: "80.5%", left: "93.7%", name: "Room 302", images: [
            "src/img/facility/or.avif"
          ], descriptions: [
            "Room Details: Regular Private"
            ] },
            { top: "80.5%", left: "96.5%", name: "Room 301", images: [
            "src/img/facility/or.avif"
          ], descriptions: [
            "Room Details: Regular Private"
            ] },
            
        ] },
        
      5: { image: "src/img/floor_plan/5.avif", hotspots: [
          { top: "50%", left: "50%", name: "Suite Room", images: [
            "src/img/facility/or.avif"
          ], descriptions: "Luxurious suite for VIP patients." },
        ] },
      6: { image: "src/img/floor_plan/6.avif", hotspots: [
          { top: "40%", left: "60%", name: "Board of Directors Office", images: [
            "src/img/facility/or.avif"
          ], descriptions: "Administrative board meeting office." },
        ] }
    };
    
// DOM elements
const floorButtons = document.querySelectorAll('.floor-btn');
const floorContainer = document.getElementById('floorContainer');
const modal = document.getElementById('facilityModal');
const modalName = document.getElementById('modalName');
const modalDesc = document.getElementById('modalDesc');
const closeModal = document.getElementById('closeModal');
const currentImageEl = document.getElementById('currentImage');
const thumbnailContainer = document.getElementById('thumbnailContainer');

let activeFloor = 1;
let currentImageIndex = 0;
let currentImages = [];

// Fade-in helper
function fadeIn(element) {
  element.style.opacity = 0;
  element.style.transition = 'opacity 0.4s ease';
  requestAnimationFrame(() => {
    element.style.opacity = 1;
  });
}

// Load floor dynamically
function loadFloor(floorNumber) {
  const floor = floors[floorNumber];
  floorContainer.innerHTML = '';

  const floorWrapper = document.createElement('div');
  floorWrapper.className = 'relative w-full';

  const floorImg = document.createElement('img');
  floorImg.src = floor.image;
  floorImg.alt = `Floor ${floorNumber}`;
  floorImg.className = 'w-full h-auto';
  floorWrapper.appendChild(floorImg);
  floorContainer.appendChild(floorWrapper);
  fadeIn(floorWrapper);

  // Add hotspots
  floor.hotspots.forEach((h) => createHotspot(h, floorWrapper));

  // Update button highlight
  floorButtons.forEach(b => b.classList.remove('bg-green-600', 'text-white'));
  document.querySelector(`.floor-btn[data-floor="${floorNumber}"]`).classList.add('bg-green-600', 'text-white');
  activeFloor = parseInt(floorNumber);
}

// Create hotspot with responsive tooltip
function createHotspot(h, wrapper) {
  const hotspot = document.createElement("div");
  hotspot.className = "hotspot absolute rounded-full cursor-pointer";

  const viewportWidth = window.innerWidth;
  let hotspotSize, tooltipFont;

  if (viewportWidth < 480) {
    hotspotSize = 12; tooltipFont = "10px";
  } else if (viewportWidth < 768) {
    hotspotSize = 16; tooltipFont = "11px";
  } else {
    hotspotSize = 24; tooltipFont = "12px";
  }

  hotspot.style.width = `${hotspotSize}px`;
  hotspot.style.height = `${hotspotSize}px`;
  hotspot.style.backgroundColor = "rgba(22, 163, 74, 0.5)";
  hotspot.style.top = h.top;
  hotspot.style.left = h.left;

  const tooltip = document.createElement("span");
  tooltip.className = "tooltip absolute bg-black text-white px-2 py-1 rounded whitespace-nowrap";
  tooltip.style.fontSize = tooltipFont;
  tooltip.style.opacity = "1";
  tooltip.textContent = h.name;
  tooltip.style.top = `-150%`;
  tooltip.style.left = `50%`;
  tooltip.style.transform = `translateX(-50%)`;

  hotspot.appendChild(tooltip);
  wrapper.appendChild(hotspot);

  requestAnimationFrame(() => adjustTooltip(tooltip));
  hotspot.addEventListener("click", () => openModal(h));
}

function adjustTooltip(tooltip) {
  const rect = tooltip.getBoundingClientRect();
  const viewportWidth = window.innerWidth;

  if (rect.top < 10) tooltip.style.top = `150%`;
  if (rect.left < 0) {
    tooltip.style.left = `0`;
    tooltip.style.transform = `translateX(0)`;
  }
  if (rect.right > viewportWidth) {
    tooltip.style.left = `100%`;
    tooltip.style.transform = `translateX(-100%)`;
  }
}

// Modal handling
function openModal(hotspot) {
  modalName.textContent = hotspot.name;
  modalDesc.innerHTML = '';

  if (Array.isArray(hotspot.descriptions)) {
    hotspot.descriptions.forEach(desc => {
      const p = document.createElement('p');
      p.textContent = desc;
      p.className = 'mb-2 text-gray-700';
      modalDesc.appendChild(p);
    });
  } else {
    modalDesc.textContent = hotspot.descriptions || "";
  }

  currentImages = hotspot.images || [];
  currentImageIndex = 0;
  if (currentImages.length > 0) currentImageEl.src = currentImages[currentImageIndex];

  generateThumbnails();
  modal.classList.remove('hidden');
}

// Swipe to close modal on mobile
let touchStartY = 0;
let touchEndY = 0;

// Close modal when tapping the background (click or tap)
modal.addEventListener('click', (e) => {
  // Only close if the background (not modal content) is clicked
  if (e.target === modal) {
    modal.classList.add('hidden');
  }
});

// Swipe to close modal (up or down)
modal.addEventListener('touchstart', (e) => {
  if (e.target !== modal) return; // only swipe on background
  touchStartY = e.changedTouches[0].screenY;
}, { passive: true });

modal.addEventListener('touchend', (e) => {
  if (e.target !== modal) return; // only swipe on background
  touchEndY = e.changedTouches[0].screenY;
  handleSwipeGesture();
});

function handleSwipeGesture() {
  const swipeDistance = touchEndY - touchStartY;

  // Close only if swipe distance is significant (50px up/down)
  if (Math.abs(swipeDistance) > 50) {
    modal.classList.add('hidden');
  }
}

// Close modal when clicking/tapping the background
modal.addEventListener('click', (e) => {
  if (e.target === modal) {
    modal.classList.add('hidden');
  }
});

function generateThumbnails() {
  thumbnailContainer.innerHTML = '';
  currentImages.forEach((img, index) => {
    const thumb = document.createElement('img');
    thumb.src = img;
    thumb.className = `w-16 h-16 object-cover rounded cursor-pointer border ${index === currentImageIndex ? 'border-green-600' : 'border-gray-300'}`;
    thumb.addEventListener('click', () => {
      currentImageIndex = index;
      updateImage();
    });
    thumbnailContainer.appendChild(thumb);
  });
}

function updateImage() {
  currentImageEl.src = currentImages[currentImageIndex];
  const thumbs = thumbnailContainer.querySelectorAll('img');
  thumbs.forEach((thumb, idx) => {
    thumb.classList.toggle('border-green-600', idx === currentImageIndex);
    thumb.classList.toggle('border-gray-300', idx !== currentImageIndex);
  });
}

closeModal.addEventListener('click', () => modal.classList.add('hidden'));

// Image slideshow buttons
document.getElementById('nextImage').addEventListener('click', () => showNextImage());
document.getElementById('prevImage').addEventListener('click', () => showPrevImage());

function showNextImage() {
  if (currentImages.length > 0) {
    currentImageIndex = (currentImageIndex + 1) % currentImages.length;
    updateImage();
  }
}

function showPrevImage() {
  if (currentImages.length > 0) {
    currentImageIndex = (currentImageIndex - 1 + currentImages.length) % currentImages.length;
    updateImage();
  }
}

// Modal swipe for images
const modalImageWrapper = document.getElementById('modalImageWrapper');
let touchStartX = 0, touchEndX = 0;

modalImageWrapper.addEventListener('touchstart', e => touchStartX = e.changedTouches[0].screenX);
modalImageWrapper.addEventListener('touchend', e => {
  touchEndX = e.changedTouches[0].screenX;
  if (touchEndX < touchStartX - 50) showNextImage();
  else if (touchEndX > touchStartX + 50) showPrevImage();
});

// Floor swipe navigation
let floorTouchStartX = 0, floorTouchEndX = 0;
floorContainer.addEventListener('touchstart', e => floorTouchStartX = e.changedTouches[0].screenX);
floorContainer.addEventListener('touchend', e => {
  floorTouchEndX = e.changedTouches[0].screenX;
  const swipeThreshold = 50;
  if (floorTouchEndX < floorTouchStartX - swipeThreshold && activeFloor < Object.keys(floors).length) {
    loadFloor(activeFloor + 1); // Swipe left → Next floor
  } 
  else if (floorTouchEndX > floorTouchStartX + swipeThreshold && activeFloor > 1) {
    loadFloor(activeFloor - 1); // Swipe right → Previous floor
  }
});

// Keyboard navigation (optional)
document.addEventListener('keydown', (e) => {
  if (!modal.classList.contains('hidden')) {
    if (e.key === 'ArrowRight') showNextImage();
    if (e.key === 'ArrowLeft') showPrevImage();
    if (e.key === 'Escape') modal.classList.add('hidden');
  } else {
    if (e.key === 'ArrowUp' && activeFloor < Object.keys(floors).length) loadFloor(activeFloor + 1);
    if (e.key === 'ArrowDown' && activeFloor > 1) loadFloor(activeFloor - 1);
  }
});

// Floor buttons
floorButtons.forEach(btn => btn.addEventListener('click', () => loadFloor(btn.dataset.floor)));

// Initialize default floor
loadFloor(activeFloor);

// Recalculate hotspots on resize
window.addEventListener('resize', () => loadFloor(activeFloor));



//TOOLTIP
    const circleWrapper = document.querySelector(".circle-wrapper");
    const circleTooltip = document.querySelector(".circle-tooltip");
    
    circleWrapper.addEventListener("mouseenter", () => {
      requestAnimationFrame(() => {
        const rect = circleTooltip.getBoundingClientRect();
        const vw = window.innerWidth;
        const vh = window.innerHeight;
    
        // Reset to default (above)
        circleTooltip.style.bottom = "100%";
        circleTooltip.style.top = "auto";
        circleTooltip.style.left = "50%";
        circleTooltip.style.transform = "translateX(-50%)";
        circleTooltip.style.right = "auto";
        circleTooltip.style.whiteSpace = "nowrap";
        circleTooltip.style.maxWidth = "none";
        circleTooltip.style.textAlign = "center";
    
        // Flip below if too close to top
        if (rect.top < 10) {
          circleTooltip.style.top = "100%";
          circleTooltip.style.bottom = "auto";
          circleTooltip.style.transform = "translateX(-50%)";
        }
    
        // Shift right if overflowing left
        if (rect.left < 0) {
          circleTooltip.style.left = "0";
          circleTooltip.style.transform = "translateX(0)";
        }
    
        // Shift left if overflowing right
        if (rect.right > vw) {
          circleTooltip.style.left = "auto";
          circleTooltip.style.right = "0";
          circleTooltip.style.transform = "translateX(0)";
        }
      });
    });